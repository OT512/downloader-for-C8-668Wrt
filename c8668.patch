diff --git a/scripts/dl_github_archive.py b/scripts/dl_github_archive.py
index 328d588..d885769 100755
--- a/scripts/dl_github_archive.py
+++ b/scripts/dl_github_archive.py
@@ -398,6 +398,9 @@ class DownloadGitHubTarball(object):
             'Accept': 'application/vnd.github.v3+json',
             'User-Agent': 'OpenWrt',
         }
+        proxy_handler = urllib.request.ProxyHandler({"https": "http://192.168.1.32:10808", "http": "http://192.168.1.32:10808"})
+        opener = urllib.request.build_opener(proxy_handler)
+        urllib.request.install_opener(opener)
         req = urllib.request.Request(url, headers=headers)
         sslcontext = ssl._create_unverified_context()
         fileobj = urllib.request.urlopen(req, context=sslcontext)
diff --git a/scripts/download.pl b/scripts/download.pl
index c5d1c6a..1f72301 100755
--- a/scripts/download.pl
+++ b/scripts/download.pl
@@ -345,10 +345,38 @@ foreach my $mirror (@ARGV) {
 	}
 }
 
+# 优先使用的快速镜像源
+push @mirrors, 'https://mirrors.tuna.tsinghua.edu.cn/immortalwrt/sources';
+push @mirrors, 'https://mirrors.ustc.edu.cn/immortalwrt/sources';
+push @mirrors, 'https://mirror.iscas.ac.cn/immortalwrt/sources';
+push @mirrors, 'https://mirrors.tuna.tsinghua.edu.cn/openwrt/sources';
+push @mirrors, 'https://mirrors.ustc.edu.cn/openwrt/sources';
+
 push @mirrors, 'https://mirror2.immortalwrt.org/sources';
+# 优先使用的快速镜像源
+push @mirrors, 'https://mirrors.tuna.tsinghua.edu.cn/immortalwrt/sources';
+push @mirrors, 'https://mirrors.ustc.edu.cn/immortalwrt/sources';
+push @mirrors, 'https://mirror.iscas.ac.cn/immortalwrt/sources';
+push @mirrors, 'https://mirrors.tuna.tsinghua.edu.cn/openwrt/sources';
+push @mirrors, 'https://mirrors.ustc.edu.cn/openwrt/sources';
+
 push @mirrors, 'https://mirror.immortalwrt.org/sources';
-push @mirrors, 'https://sources-cdn.immortalwrt.org';
-push @mirrors, 'https://sources.immortalwrt.org';
+# 优先使用的快速镜像源
+push @mirrors, 'https://mirrors.tuna.tsinghua.edu.cn/immortalwrt/sources';
+push @mirrors, 'https://mirrors.ustc.edu.cn/immortalwrt/sources';
+push @mirrors, 'https://mirror.iscas.ac.cn/immortalwrt/sources';
+push @mirrors, 'https://mirrors.tuna.tsinghua.edu.cn/openwrt/sources';
+push @mirrors, 'https://mirrors.ustc.edu.cn/openwrt/sources';
+
+# push @mirrors, 'https://sources-cdn.immortalwrt.org'; # 太慢，已禁用
+# 优先使用的快速镜像源
+push @mirrors, 'https://mirrors.tuna.tsinghua.edu.cn/immortalwrt/sources';
+push @mirrors, 'https://mirrors.ustc.edu.cn/immortalwrt/sources';
+push @mirrors, 'https://mirror.iscas.ac.cn/immortalwrt/sources';
+push @mirrors, 'https://mirrors.tuna.tsinghua.edu.cn/openwrt/sources';
+push @mirrors, 'https://mirrors.ustc.edu.cn/openwrt/sources';
+
+# push @mirrors, 'https://sources.immortalwrt.org'; # 太慢，已禁用
 push @mirrors, 'https://sources.cdn.openwrt.org';
 push @mirrors, 'https://sources.openwrt.org';
 push @mirrors, 'https://mirror2.openwrt.org/sources';
diff --git a/target/linux/mediatek/filogic/base-files/etc/board.d/01_leds b/target/linux/mediatek/filogic/base-files/etc/board.d/01_leds
index 4f4377c..ee58f13 100644
--- a/target/linux/mediatek/filogic/base-files/etc/board.d/01_leds
+++ b/target/linux/mediatek/filogic/base-files/etc/board.d/01_leds
@@ -1,3 +1,8 @@
+#!/bin/sh
+#
+# Copyright © 2017 OpenWrt.org
+#
+
 . /lib/functions/leds.sh
 . /lib/functions/uci-defaults.sh
 
@@ -5,87 +10,48 @@ board=$(board_name)
 
 board_config_update
 
-case $board in
-abt,asr3000|\
-abt,asr3000-ubootmod)
+case "$board" in
+abt,asr3000)
 	ucidef_set_led_netdev "wan" "WAN" "green:wan" "eth1"
-	ucidef_set_led_netdev "wlan2g" "WLAN2G" "green:wlan2g" "phy0-ap0"
-	ucidef_set_led_netdev "wlan5g" "WLAN5G" "green:wlan5g" "phy1-ap0"
-	;;
-bananapi,bpi-r3-mini)
-	ucidef_set_led_netdev "wlan2g" "WLAN2G" "blue:wlan2g" "phy0-ap0"
-	ucidef_set_led_netdev "wlan5g" "WLAN5G" "blue:wlan5g" "phy1-ap0"
-	;;
-confiabits,mt7981)
-	ucidef_set_led_netdev "lan1" "lan1" "blue:lan-1" "lan1" "link tx rx"
-	ucidef_set_led_netdev "lan2" "lan2" "blue:lan-2" "lan2" "link tx rx"
-	ucidef_set_led_netdev "lan3" "lan3" "blue:lan-3" "lan3" "link tx rx"
-	ucidef_set_led_netdev "wan" "wan" "blue:wan" "wan" "link tx rx"
-	;;
-cudy,re3000-v1)
-	ucidef_set_led_netdev "lan" "lan" "green:lan" "eth0" "link tx rx"
+	ucidef_set_led_netdev "wlan2g" "WLAN2G" "green:wlan2g" "ra0"
+	ucidef_set_led_netdev "wlan5g" "WLAN5G" "green:wlan5g" "rax0"
 	;;
-cudy,wr3000-v1)
-	ucidef_set_led_netdev "wan" "wan" "blue:wan" "wan"
+clt,r30b1)
+	ucidef_set_led_default "all_ctrl" "ALL_CTRL" "ctrl_led_all" "1"
+	ucidef_set_led_default "internet" "INTERNET" "led_internet" "1"
+	ucidef_set_led_default "power_red" "POWER_RED" "led_power" "0"
 	;;
-huasifei,wh3000-emmc)
-	ucidef_set_led_netdev "wan" "WAN" "red:wan" "eth1"
-	ucidef_set_led_netdev "wlan" "WLAN" "white:wlan" "phy1-ap0"
-	;;
-imou,lc-hx3001|\
-imou,lc-hx3001-ubootmod|\
-nokia,ea0326gmp)
+imou,lc-hx3001)
 	ucidef_set_led_netdev "wan" "WAN" "green:wan" "eth1" "link"
-	ucidef_set_led_netdev "lan" "LAN" "green:lan" "br-lan" "link"
-	ucidef_set_led_netdev "wlan" "WLAN" "green:wlan" "phy1-ap0" "link"
-	;;
-livinet,zr-3020|\
-livinet,zr-3020-ubootmod)
-	ucidef_set_led_netdev "internet" "INTERNET" "blue:internet" "wan"
-	ucidef_set_led_netdev "wlan2g" "WLAN2G" "blue:wlan2g" "phy0-ap0"
-	ucidef_set_led_netdev "wlan5g" "WLAN5G" "blue:wlan5g" "phy1-ap0"
-	;;
-mercusys,mr90x-v1)
-	ucidef_set_led_netdev "lan0" "lan0" "green:lan0" "lan0" "link tx rx"
-	ucidef_set_led_netdev "lan1" "lan2" "green:lan1" "lan1" "link tx rx"
-	ucidef_set_led_netdev "lan2" "lan2" "green:lan2" "lan2" "link tx rx"
-	ucidef_set_led_netdev "wan" "wan" "green:wan" "eth1" "link tx rx"
+	ucidef_set_led_netdev "lan" "LAN" "green:lan" "eth0" "link"
+	ucidef_set_led_netdev "wlan" "WLAN" "green:wlan" "rax0" "link"
 	;;
-netcore,n60-pro)
-	ucidef_set_led_netdev "wan" "WAN" "blue:wan" "eth1" "link"
+livinet,zr-3020)
+	ucidef_set_led_netdev "internet" "INTERNET" "blue:internet" "eth1"
+	ucidef_set_led_netdev "wlan2g" "WLAN2G" "blue:wlan2g" "ra0" "link"
+	ucidef_set_led_netdev "wlan5g" "WLAN5G" "blue:wlan5g" "rax0" "link"
 	;;
-netgear,wax220)
-	ucidef_set_led_netdev "eth0" "LAN" "green:lan" "eth0"
-	ucidef_set_led_netdev "wlan2g" "WLAN2G" "blue:wlan2g" "phy0-ap0"
-	ucidef_set_led_netdev "wlan5g" "WLAN5G" "blue:wlan5g" "phy1-ap0"
+xiaomi,mi-router-wr30u*)
+	ucidef_set_led_netdev "network" "NETWORK" "blue:network" "eth1"
 	;;
-routerich,ax3000)
-	ucidef_set_led_netdev "lan-1" "lan-1" "blue:lan-1" "lan1" "link tx rx"
-	ucidef_set_led_netdev "lan-2" "lan-2" "blue:lan-2" "lan2" "link tx rx"
-	ucidef_set_led_netdev "lan-3" "lan-3" "blue:lan-3" "lan3" "link tx rx"
-	ucidef_set_led_netdev "wan" "wan" "blue:wan" "wan" "link tx rx"
-	ucidef_set_led_netdev "wan-off" "wan-off" "red:wan" "wan" "link"
+*360,t7*)
+	ucidef_set_led_default "green" "GREEN" "360t7:green" "1"
+	ucidef_set_led_default "red" "RED" "360t7:red" "0"
 	;;
-xiaomi,mi-router-wr30u-112m-nmbm|\
-xiaomi,mi-router-wr30u-stock|\
-xiaomi,mi-router-wr30u-ubootmod)
-	ucidef_set_led_netdev "wan" "wan" "blue:wan" "wan" "link tx rx"
+h3c,nx30pro)
+	ucidef_set_led_default "green" "GREEN" "nx30pro:green" "1"
+	ucidef_set_led_default "red" "RED" "nx30pro:red" "0"
 	;;
-xiaomi,redmi-router-ax6000|\
-xiaomi,redmi-router-ax6000-stock|\
-xiaomi,redmi-router-ax6000-ubootmod)
-	ucidef_set_led_netdev "wan" "wan" "rgb:network" "wan" "link"
+konka,komi-a31)
+        ucidef_set_led_netdev "blue" "BLUE" "blue:status" "eth1" "link"
 	;;
-zbtlink,zbt-z8103ax)
-	ucidef_set_led_netdev "wan" "wan" "green:wan" "eth1" "link tx rx"
+HCMT7981-EMMC|\
+nradio,wt9103)
+	ucidef_set_led_default "power" "POWER" "hc:blue:status" "1"
+	ucidef_set_led_netdev "wifi" "WIFI" "hc:blue:wifi" "rax0" "link"
+	ucidef_set_led_netdev "5g" "5G" "hc:blue:cmode5" "eth1" "tx rx"
+	ucidef_set_led_netdev "lan" "LAN" "hc:blue:cmode4" "br-lan" "tx rx"
 	;;
-zyxel_ex5601-t0-stock|\
-zyxel,ex5601-t0-ubootmod)
-	ucidef_set_led_netdev "lan" "LAN" "green:lan" "eth0" "link tx rx"
-	ucidef_set_led_netdev "wan" "WAN" "green:inet" "eth1" "link tx rx"
-	ucidef_set_led_netdev "wifi-24g" "WIFI-2.4G" "green:wifi24g" "phy0-ap0" "link tx rx"
-	ucidef_set_led_netdev "wifi-5g" "WIFI-5G" "green:wifi5g" "phy1-ap0" "link tx rx"
-        ;;
 esac
 
 board_config_flush
diff --git a/target/linux/mediatek/filogic/base-files/etc/board.d/02_network b/target/linux/mediatek/filogic/base-files/etc/board.d/02_network
index 5e534b4..29945db 100644
--- a/target/linux/mediatek/filogic/base-files/etc/board.d/02_network
+++ b/target/linux/mediatek/filogic/base-files/etc/board.d/02_network
@@ -1,3 +1,4 @@
+#!/bin/sh
 
 . /lib/functions.sh
 . /lib/functions/uci-defaults.sh
@@ -8,242 +9,248 @@ mediatek_setup_interfaces()
 	local board="$1"
 
 	case $board in
-	abt,asr3000|\
-	abt,asr3000-ubootmod|\
-	cmcc,rax3000m|\
-	cmcc,rax3000m-emmc-ubootmod|\
-	cmcc,rax3000m-nand-ubootmod|\
-	cmcc,rax3000me|\
-	h3c,magic-nx30-pro|\
-	h3c,magic-nx30-pro-nmbm|\
-	imou,lc-hx3001|\
-	imou,lc-hx3001-ubootmod|\
-	konka,komi-a31|\
-	nokia,ea0326gmp|\
-	zbtlink,zbt-z8103ax)
-		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3" eth1
-		;;
-	acelink,ew-7886cax)
-		ucidef_set_interface_lan "eth0" "dhcp"
-		;;
-	acer,predator-w6)
-		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3 game" eth1
-		;;
-	asus,rt-ax59u|\
-	cetron,ct3003-stock|\
-	cetron,ct3003-ubootmod|\
-	cmcc,a10|\
-	cmcc,a10-stock|\
-	cmcc,a10-ubootmod|\
-	confiabits,mt7981|\
-	creatlentem,clt-r30b1|\
-	creatlentem,clt-r30b1-112m|\
-	cudy,wr3000-v1|\
-	jcg,q30|\
-	jcg,q30-ubootmod|\
-	livinet,zr-3020|\
-	livinet,zr-3020-ubootmod|\
-	qihoo,360t7|\
-	qihoo,360t7-ubootmod|\
-	routerich,ax3000)
-		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3" "wan"
-		;;
-	asus,tuf-ax4200|\
-	jdcloud,re-cp-03|\
-	mediatek,mt7981-rfb|\
-	netcore,n60|\
-	netcore,n60-pro|\
-	ruijie,rg-x60-pro|\
-	unielec,u7981-01*|\
-	zbtlink,zbt-z8102ax|\
-	zyxel,ex5601-t0-stock|\
-	zyxel,ex5601-t0-ubootmod)
-		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3 lan4" eth1
-		;;
-	asus,tuf-ax6000)
-		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3 lan4 lan5" eth1
-		;;
-	bananapi,bpi-r3)
-		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3 lan4 sfp2" "eth1 wan"
-		;;
-	bananapi,bpi-r3-mini)
+	*fpga*)
 		ucidef_set_interfaces_lan_wan "eth0" "eth1"
+		ucidef_add_switch "switch0" \
+			"0:lan" "1:lan" "2:lan" "3:lan" "4:wan" "6u@eth0" "5u@eth1"
 		;;
-	comfast,cf-e393ax)
-		ucidef_set_interfaces_lan_wan "lan1" eth1
-		;;
-	cudy,m3000-v1|\
-	cudy,tr3000-v1|\
-	cudy,tr3000-v1-ubootmod|\
-	glinet,gl-mt2500|\
-	glinet,gl-mt3000)
-		ucidef_set_interfaces_lan_wan eth1 eth0
-		;;
-	dlink,aquila-pro-ai-m30-a1)
-		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3 lan4" internet
-		;;
-	glinet,gl-mt6000|\
-	tplink,tl-xdr4288|\
-	tplink,tl-xdr6088|\
-	tplink,tl-xtr8488)
-		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3 lan4 lan5" eth1
+	*gsw*)
+		ucidef_set_interfaces_lan_wan "eth0" "eth1"
+		ucidef_add_switch "switch0" \
+			"0:lan" "1:lan" "2:lan" "3:lan" "4:lan" "6u@eth0"
 		;;
-	huasifei,wh3000-emmc)
-		ucidef_set_interfaces_lan_wan eth0 eth1
+	*2500wan-p5*)
+		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3 lan4" wan
 		;;
-	mediatek,mt7986a-rfb)
-		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3 lan4 lan6" "eth1 wan"
+	xiaomi,mi-router-ax3000t* |\
+	xiaomi,mi-router-wr30u*)
+		ucidef_set_interfaces_lan_wan "eth0" "eth1"
+		ucidef_add_switch "switch0" \
+			"1:lan" "2:lan" "3:lan" "0:wan" "6u@eth0" "5u@eth1"
 		;;
-	mediatek,mt7986b-rfb)
-		ucidef_set_interfaces_lan_wan "lan0 lan1 lan2 lan3" eth1
+	*360,t7*)
+		ucidef_set_interfaces_lan_wan "eth0" "eth1"
+		ucidef_add_switch "switch0" \
+			"0:lan" "1:lan" "2:lan" "3:wan" "6u@eth0" "5u@eth1"
+		;;
+	*cetron,ct3003*)
+		ucidef_set_interfaces_lan_wan "eth0.1" "eth0.2"
+		ucidef_add_switch "switch0" \
+			"0:lan" "1:lan" "2:lan" "3:wan" "6t@eth0"
+		;;
+	*clt,r30b1* |\
+	h3c,nx30pro |\
+	*imou,lc-hx3001* |\
+	*konka,komi-a31*)
+		ucidef_set_interfaces_lan_wan "eth0" "eth1"
+		ucidef_add_switch "switch0" \
+			"0:lan" "1:lan" "2:lan" "6u@eth0"
 		;;
-	mediatek,mt7988a-rfb)
-		ucidef_set_interfaces_lan_wan "lan0 lan1 lan2 lan3 eth1" eth2
+	*cmcc,a10*)
+		ucidef_set_interfaces_lan_wan "eth0" "eth1"
+		ucidef_add_switch "switch0" \
+			"0:lan" "2:lan" "3:lan" "4:wan" "6u@eth0" "5u@eth1"
 		;;
-	mercusys,mr90x-v1)
-		ucidef_set_interfaces_lan_wan "lan0 lan1 lan2" eth1
+	*jcg,q30*)
+		ucidef_set_interfaces_lan_wan "eth0.1" "eth0.2"
+		ucidef_add_switch "switch0" \
+			"1:lan" "2:lan" "3:lan" "0:wan" "6t@eth0"
 		;;
-	cudy,re3000-v1|\
-	netgear,wax220|\
-	ubnt,unifi-6-plus|\
-	zyxel,nwa50ax-pro)
-		ucidef_set_interface_lan "eth0"
+	abt,asr3000 |\
+	*rax3000m*)
+		ucidef_set_interfaces_lan_wan "eth0" "eth1"
+		ucidef_add_switch "switch0" \
+			"0:lan:3" "1:lan:2" "2:lan:1" "6u@eth0"
 		;;
-	smartrg,sdg-8622|\
-	smartrg,sdg-8632|\
-	yuncore,ax835)
-		ucidef_set_interfaces_lan_wan lan wan
+	*mt3000* |\
+	glinet,x3000-emmc |\
+	*xe3000* |\
+	*mt2500*)
+		ucidef_set_interfaces_lan_wan "eth0" "eth1"
 		;;
-	tplink,tl-xdr6086)
-		ucidef_set_interfaces_lan_wan "lan1 lan2" eth1
+	*zr-3020*)
+		ucidef_set_interfaces_lan_wan "eth0" "eth1"
+		ucidef_add_switch "switch0" \
+			"2:lan" "3:lan" "4:lan" "0:wan" "6u@eth0" "5u@eth1"
 		;;
-	xiaomi,mi-router-ax3000t|\
-	xiaomi,mi-router-ax3000t-ubootmod|\
-	xiaomi,mi-router-wr30u-112m-nmbm|\
-	xiaomi,mi-router-wr30u-stock|\
-	xiaomi,mi-router-wr30u-ubootmod|\
-	xiaomi,redmi-router-ax6000|\
-	xiaomi,redmi-router-ax6000-stock|\
-	xiaomi,redmi-router-ax6000-ubootmod)
-		ucidef_set_interfaces_lan_wan "lan2 lan3 lan4" wan
+	HCMT7981-EMMC|\
+	nradio,wt9103)
+		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3 lan4" eth1
 		;;
 	*)
-		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3 lan4" wan
+		ucidef_set_interfaces_lan_wan "lan1 lan2 lan3 lan4" eth1
 		;;
 	esac
 }
 
+mtk_facrory_write_mac()
+{
+	local part_name=$1
+	local offset=$2
+	local macaddr=$3 #aa:bb:cc:dd:ee:ff
+	local data=""
+
+	part=$(find_mtd_part $part_name)
+	if [ -n "$part" ] && [ -n "$macaddr" ]; then
+		local i=1
+		for x in ${macaddr//:/ }; do
+			[ $i -gt 6 ] && break
+			data=${data}"\x${x}"
+			i=$((i+1))
+		done
+		dd if=$part of=/tmp/Factory.backup
+		printf "${data}" | dd conv=notrunc of=/tmp/Factory.backup bs=1 seek=$((${offset}))
+		mtd write /tmp/Factory.backup $part_name
+		rm -rf /tmp/Factory.backup
+	fi
+}
+
+mtk_factory_get_byte()
+{
+	local part_name=$1
+	local offset=$2
+	local len=$3
+
+	part=$(find_mtd_part $part_name)
+	if [ -n "$part" ]; then
+		hexdump -n $len -s $offset -e ''`expr ${len} - 1`'/1 "%02x-" "%02x"' $part
+	fi
+}
+
 mediatek_setup_macs()
 {
 	local board="$1"
+	local part_name="Factory"
 	local lan_mac=""
 	local wan_mac=""
-	local label_mac=""
+	local lan_mac_offset="0x2A"
+	local wan_mac_offset="0x24"
 
 	case $board in
-	asus,rt-ax59u|\
-	asus,tuf-ax4200|\
-	asus,tuf-ax6000)
-		CI_UBIPART="UBI_DEV"
-		addr=$(mtd_get_mac_binary_ubi "Factory" 0x4)
-		wan_mac="${addr}"
-		lan_mac="${addr}"
-		;;
-	bananapi,bpi-r3)
-		wan_mac=$(macaddr_add $(cat /sys/class/net/eth0/address) 1)
-		;;
-	bananapi,bpi-r3-mini)
-		lan_mac=$(macaddr_generate_from_mmc_cid mmcblk0)
-		wan_mac=$(macaddr_add "$lan_mac" 1)
-		;;
-	cmcc,rax3000m)
-		case "$(cmdline_get_var root)" in
-		/dev/mmc*)
-			wan_mac=$(mmc_get_mac_binary factory 0x24)
-			lan_mac=$(mmc_get_mac_binary factory 0x2a)
-			label_mac=$wan_mac
+	*mt3000*)
+		wan_mac=$(mtd_get_mac_binary $part_name 0x0a)
+		lan_mac=$(macaddr_add "$wan_mac" 1)
 		;;
-		esac
+	*mt2500*)
+		wan_mac=$(get_mac_binary /dev/mmcblk0boot1 0x0a)
+		lan_mac=$(macaddr_add "$wan_mac" 1)
 		;;
-	cmcc,rax3000m-emmc-ubootmod)
-		wan_mac=$(mmc_get_mac_binary factory 0x2a)
-		lan_mac=$(mmc_get_mac_binary factory 0x24)
-		label_mac=$wan_mac
+	*xe3000*|\
+	glinet,x3000-emmc)
+		wan_mac=$(get_mac_binary /dev/mmcblk0p3 0x0a)
+		lan_mac=$(macaddr_add "$wan_mac" 1)
 		;;
-	glinet,gl-mt2500)
-		label_mac="$(get_mac_binary "/dev/mmcblk0boot1" 0xA)"
-		wan_mac="$label_mac"
-		lan_mac="$(macaddr_add $label_mac 1)"
+	*zr-3020*)
+		wan_mac=$(mtd_get_mac_ascii config2 wanmac)
+		lan_mac=$(mtd_get_mac_ascii config2 lanmac)
+		if [ "$(mtk_factory_get_byte Factory 4 2)" = "00-0c" ]; then
+			local wifi_mac="$(mtd_get_mac_ascii config2 wifi2gmac)"
+			mtk_facrory_write_mac Factory 4 "$wifi_mac"
+		fi
 		;;
-	glinet,gl-mt6000)
-		label_mac=$(mmc_get_mac_binary factory 0x0a)
+	xiaomi,mi-router-ax3000t* |\
+	xiaomi,mi-router-wr30u*)
+		wan_mac=$(mtd_get_mac_ascii Bdata ethaddr_wan)
+		lan_mac=$(mtd_get_mac_ascii Bdata ethaddr)
+		;;
+	*360,t7*)
+		local part=$(find_mtd_part "stock-factory")
+		if [ -n "$part" ]; then
+			local factoryMac="$(dd if=$part bs=1 count=200 2>/dev/null |grep "^lanMac=")"
+			if [ -n "$factoryMac" ]; then
+				lan_mac="${factoryMac#lanMac=}"
+				wan_mac="$(macaddr_add $lan_mac 0x1)"
+				if [ "$(mtk_factory_get_byte "Factory" 4 2)" = "00-0c" ]; then
+					local wifi_mac="$(macaddr_add $lan_mac 0x2)"
+					mtk_facrory_write_mac "Factory" 4 $wifi_mac
+				fi
+			fi
+		fi
+		;;
+	*abt,asr3000*)
+		label_mac=$(mtd_get_mac_ascii art MAC_ADDRESS)
+		lan_mac=$label_mac
 		wan_mac=$label_mac
-		lan_mac=$(macaddr_add "$label_mac" 2)
+		local wifi_mac="$(macaddr_add $label_mac 1)"
+		mtk_facrory_write_mac Factory 4 "$wifi_mac"
 		;;
-	h3c,magic-nx30-pro|\
-	h3c,magic-nx30-pro-nmbm)
-		wan_mac=$(mtd_get_mac_ascii pdt_data_1 ethaddr)
-		lan_mac=$(macaddr_add "$wan_mac" 1)
-		label_mac=$wan_mac
-		;;
-	huasifei,wh3000-emmc)
-		lan_mac="$(macaddr_add "$(mmc_get_mac_binary factory 0x4)" 2)"
-		wan_mac="$(macaddr_add "$lan_mac" 1)"
+	*cetron,ct3003*)
+		lan_mac=$(mtd_get_mac_ascii art MAC_ADDRESS)
+		wan_mac=$(macaddr_add $lan_mac 3)
+		label_mac=$lan_mac
+		local wifi_mac="$(macaddr_add $lan_mac 1)"
+		mtk_facrory_write_mac Factory 4 "$wifi_mac"
 		;;
-	imou,lc-hx3001-ubootmod)
-		lan_mac=$(mtd_get_mac_ascii u-boot-env mac)
-		[ -z "$lan_mac" ] || wan_mac=$(macaddr_add $lan_mac 2)
+	*clt,r30b1*)
+		lan_mac=$(mtd_get_mac_binary $part_name 0x2A)
+		wan_mac=$(mtd_get_mac_binary $part_name 0x24)
+		label_mac=$lan_mac
+		local wifi_mac="$(mtd_get_mac_binary $part_name 0x04)"
 		;;
-	jdcloud,re-cp-03)
-		wan_mac=$(mmc_get_mac_binary factory 0x24)
-		lan_mac=$(mmc_get_mac_binary factory 0x2a)
+	cmcc,rax3000m-emmc)
+		lan_mac=$(mmc_get_mac_binary factory 0x24)
+		wan_mac=$(mmc_get_mac_binary factory 0x2a)
 		label_mac=$wan_mac
 		;;
-	mercusys,mr90x-v1)
-		label_mac=$(get_mac_binary "/tmp/tp_data/default-mac" 0)
-		lan_mac=$label_mac
-		;;
-	netgear,wax220)
-		lan_mac=$(mtd_get_mac_ascii u-boot-env mac)
+	*imou,lc-hx3001*)
+		if [ -n "$(mtd_get_mac_ascii u-boot-env mac)" ]; then
+			lan_mac=$(mtd_get_mac_ascii u-boot-env mac)
+			wan_mac=$(macaddr_add $lan_mac 2)
+			label_mac=$lan_mac
+		else
+			local wifi_mac=$(mtd_get_mac_binary Factory 0x4)
+			lan_mac=$(macaddr_add $wifi_mac -1)
+			wan_mac=$(macaddr_add $wifi_mac 1)
+		fi
+		;;
+	HCMT7981-EMMC|\
+	nradio,wt9103)
+		lan_mac=$(mtd_get_mac_ascii bdinfo "fac_mac ")
 		label_mac=$lan_mac
-		;;
-	qihoo,360t7)
-		lan_mac=$(mtd_get_mac_ascii factory lanMac)
+		[ -n "$lan_mac" ] || lan_mac=$(cat /sys/class/net/eth0/address)
 		wan_mac=$(macaddr_add "$lan_mac" 1)
-		label_mac=$wan_mac
 		;;
-	ruijie,rg-x60-pro)
-		label_mac=$(mtd_get_mac_ascii product_info ethaddr)
-		wan_mac=$label_mac
-		lan_mac=$(macaddr_add "$label_mac" 1)
+	*jcg,q30*)
+		wan_mac=$(mtd_get_mac_binary $part_name 0xa0024)
+		lan_mac=$(mtd_get_mac_binary $part_name 0xa002a)
+		label_mac=$lan_mac
 		;;
-	smartrg,sdg-8612|\
-	smartrg,sdg-8614|\
-	smartrg,sdg-8622|\
-	smartrg,sdg-8632)
-		label_mac=$(mmc_get_mac_ascii mfginfo MFG_MAC)
-		wan_mac=$label_mac
-		lan_mac=$(macaddr_add "$label_mac" 1)
-		;;
-	xiaomi,mi-router-ax3000t|\
-	xiaomi,mi-router-ax3000t-ubootmod|\
-	xiaomi,mi-router-wr30u-112m-nmbm|\
-	xiaomi,mi-router-wr30u-stock|\
-	xiaomi,mi-router-wr30u-ubootmod|\
-	xiaomi,redmi-router-ax6000|\
-	xiaomi,redmi-router-ax6000-stock|\
-	xiaomi,redmi-router-ax6000-ubootmod)
-		wan_mac=$(mtd_get_mac_ascii Bdata ethaddr_wan)
+	h3c,nx30pro)
+		wan_mac=$(mtd_get_mac_ascii pdt_data_1 ethaddr)
+		lan_mac=$(macaddr_add $wan_mac 1)
+		if [ "$(mtk_factory_get_byte "Factory" 4 2)" = "00-0c" ]; then
+			local wifi_mac="$(macaddr_add $wan_mac 2)"
+			mtk_facrory_write_mac "Factory" 4 $wifi_mac
+		fi
+		;;
+	*cmcc,a10* |\
+	*konka,komi-a31*)
+		lan_mac=$(mtd_get_mac_binary $part_name 0x2A)
+		wan_mac=$(mtd_get_mac_binary $part_name 0x24)
 		label_mac=$wan_mac
+		local wifi_mac="$(mtd_get_mac_binary $part_name 0x04)"
 		;;
-	yuncore,ax835)
-		label_mac=$(mtd_get_mac_binary "Factory" 0x4)
+	*)
+		wan_mac=$(mtd_get_mac_binary $part_name $wan_mac_offset)
+		lan_mac=$(mtd_get_mac_binary $part_name $lan_mac_offset)
 		;;
 	esac
 
-	[ -n "$lan_mac" ] && ucidef_set_interface_macaddr "lan" $lan_mac
-	[ -n "$wan_mac" ] && ucidef_set_interface_macaddr "wan" $wan_mac
-	[ -n "$label_mac" ] && ucidef_set_label_macaddr $label_mac
+	case "$lan_mac" in
+		00:00:00:00:00:00);;
+		ff:ff:ff:ff:ff:ff);;
+		*)
+		[ -n "$lan_mac" ] && ucidef_set_interface_macaddr "lan" "$lan_mac"
+	;;
+	esac
+
+	case "$wan_mac" in
+		00:00:00:00:00:00);;
+		ff:ff:ff:ff:ff:ff);;
+		*)
+		[ -n "$wan_mac" ] && ucidef_set_interface_macaddr "wan" "$wan_mac"
+	;;
+	esac
 }
 
 board_config_update
diff --git a/target/linux/mediatek/filogic/base-files/lib/upgrade/platform.sh b/target/linux/mediatek/filogic/base-files/lib/upgrade/platform.sh
index 97dc5eb..b4dad82 100755
--- a/target/linux/mediatek/filogic/base-files/lib/upgrade/platform.sh
+++ b/target/linux/mediatek/filogic/base-files/lib/upgrade/platform.sh
@@ -1,17 +1,144 @@
-REQUIRE_IMAGE_METADATA=1
+RAMFS_COPY_BIN='mkfs.f2fs blkid blockdev fw_printenv fw_setenv'
+RAMFS_COPY_DATA="/etc/fw_env.config /var/lock/fw_printenv.lock"
 
-asus_initial_setup()
+nand_remove_ubiblock() {
+	local ubivol="$1"
+
+	local ubiblk="ubiblock${ubivol:3}"
+	if [ -e "/dev/$ubiblk" ]; then
+		umount "/dev/$ubiblk" && echo "unmounted /dev/$ubiblk" || :
+		if ! ubiblock -r "/dev/$ubivol"; then
+			echo "cannot remove $ubiblk"
+			return 1
+		fi
+	fi
+}
+
+xiaomi_mt7981_nand_upgrade_tar()
 {
-	# initialize UBI if it's running on initramfs
-	[ "$(rootfs_type)" = "tmpfs" ] || return 0
+	CI_UBIPART=ubi
+	local tar_file="$1"
+	local board_dir="$(tar tf "$tar_file" | grep -m 1 '^sysupgrade-.*/$')"
+	board_dir="${board_dir%/}"
 
-	ubirmvol /dev/ubi0 -N rootfs
-	ubirmvol /dev/ubi0 -N rootfs_data
-	ubirmvol /dev/ubi0 -N jffs2
-	ubimkvol /dev/ubi0 -N jffs2 -s 0x3e000
+	local kernel_length=$( (tar xf "$tar_file" "$board_dir/kernel" -O | wc -c) 2> /dev/null)
+	[ "$kernel_length" = 0 ] && kernel_length=
+
+	local rootfs_length=$( (tar xf "$tar_file" "$board_dir/root" -O | wc -c) 2> /dev/null)
+	[ "$rootfs_length" = 0 ] && rootfs_length=
+
+	local rootfs_type
+	[ "$rootfs_length" ] && rootfs_type="$(identify_tar "$tar_file" "$board_dir/root")"
+
+	[ -n "$rootfs_length" -o -n "$kernel_length" ] || return 1
+
+	local mtdnum="$( find_mtd_index "$CI_UBIPART" )"
+	if [ ! "$mtdnum" ]; then
+		echo "cannot find ubi mtd partition ubi"
+		return 1
+	fi
+	local ubidev="$( nand_find_ubi "$CI_UBIPART" )"
+	#cleanup old data volume if exist
+	if [ "$ubidev" ] && [ "$( nand_find_volume $ubidev data )" ]; then
+		ubidetach -m "$mtdnum"
+		ubiformat /dev/mtd$mtdnum -y
+		ubiattach -m "$mtdnum"
+		ubidev="$( nand_find_ubi "$CI_UBIPART" )"
+	fi
+	if [ ! "$ubidev" ]; then
+		ubiattach -m "$mtdnum"
+		ubidev="$( nand_find_ubi "$CI_UBIPART" )"
+		if [ ! "$ubidev" ]; then
+			ubiformat /dev/mtd$mtdnum -y
+			ubiattach -m "$mtdnum"
+			ubidev="$( nand_find_ubi "$CI_UBIPART" )"
+
+			if [ ! "$ubidev" ]; then
+				echo "cannot attach ubi mtd partition ubi"
+				return 1
+			fi
+		fi
+	fi
+
+	local kern_mtdnum="$( find_mtd_index "ubi_kernel" )"
+	if [ ! "$kern_mtdnum" ]; then
+		echo "cannot find ubi_kernel mtd partition ubi_kernel"
+		return 1
+	fi
+	local kern_ubidev="$( nand_find_ubi "ubi_kernel" )"
+	if [ ! "$kern_ubidev" ]; then
+		ubiattach -m "$kern_mtdnum"
+		kern_ubidev="$( nand_find_ubi "ubi_kernel" )"
+		if [ ! "$kern_ubidev" ]; then
+			ubiformat /dev/mtd$kern_mtdnum -y
+			ubiattach -m "$kern_mtdnum"
+			kern_ubidev="$( nand_find_ubi "ubi_kernel" )"
+			if [ ! "$kern_ubidev" ]; then
+				echo "cannot attach ubi_kernel mtd partition ubi_kernel"
+				return 1
+			fi
+		fi
+	fi
+
+	local kern_ubivol="$( nand_find_volume $kern_ubidev "kernel" )"
+	local root_ubivol="$( nand_find_volume $ubidev "rootfs" )"
+	local data_ubivol="$( nand_find_volume $ubidev rootfs_data )"
+
+	[ "$kern_ubivol" ] && { nand_remove_ubiblock $kern_ubivol || return 1; }
+	[ "$root_ubivol" ] && { nand_remove_ubiblock $root_ubivol || return 1; }
+	[ "$data_ubivol" ] && { nand_remove_ubiblock $data_ubivol || return 1; }
+
+	[ "$data_ubivol" ] && ubirmvol /dev/$ubidev -N rootfs_data || :
+	[ "$root_ubivol" ] && ubirmvol /dev/$ubidev -N "rootfs" || :
+	ubirmvol /dev/$kern_ubidev -N rootfs_data 2>/dev/null || :
+	ubirmvol /dev/$kern_ubidev -N rootfs 2>/dev/null || :
+	[ "$kern_ubivol" ] && ubirmvol /dev/$kern_ubidev -N "kernel" || :
+
+	# create kernel vol in ubi_kernel
+	if ! ubimkvol /dev/$kern_ubidev -N "kernel" -s $kernel_length; then
+		echo "cannot create kernel volume"
+		return 1
+	fi
+
+	# create rootfs vol in ubi
+	local rootfs_size_param
+	if [ "$rootfs_type" = "ubifs" ]; then
+		rootfs_size_param="-m"
+	else
+		rootfs_size_param="-s $rootfs_length"
+	fi
+	if ! ubimkvol /dev/$ubidev -N "rootfs" $rootfs_size_param; then
+		echo "cannot create rootfs volume"
+		return 1;
+	fi
+
+	# create rootfs_data vol for non-ubifs rootfs in ubi
+	if [ "$rootfs_type" != "ubifs" ]; then
+		local rootfs_data_size_param="-m"
+		if ! ubimkvol /dev/$ubidev -N rootfs_data $rootfs_data_size_param; then
+			if ! ubimkvol /dev/$ubidev -N rootfs_data -m; then
+				echo "cannot initialize rootfs_data volume"
+				return 1
+			fi
+		fi
+	fi
+
+	root_ubivol="$( nand_find_volume $ubidev "rootfs" )"
+	if [ "$root_ubivol" ]; then
+		tar xf "$tar_file" "$board_dir/root" -O | \
+			ubiupdatevol /dev/$root_ubivol -s $rootfs_length -
+	fi
+
+	kern_ubivol="$( nand_find_volume $kern_ubidev "kernel" )"
+	if [ "$kern_ubivol" ]; then
+		tar xf "$tar_file" "$board_dir/kernel" -O | \
+			ubiupdatevol /dev/$kern_ubivol -s $kernel_length -
+	fi
+
+	nand_do_upgrade_success
 }
 
-xiaomi_initial_setup()
+xiaomi_mt7981_initial_setup()
 {
 	# initialize UBI and setup uboot-env if it's running on initramfs
 	[ "$(rootfs_type)" = "tmpfs" ] || return 0
@@ -49,13 +176,10 @@ xiaomi_initial_setup()
 
 	local board=$(board_name)
 	case "$board" in
-	xiaomi,mi-router-ax3000t|\
+	xiaomi,mi-router-ax3000t-stock|\
 	xiaomi,mi-router-wr30u-stock)
 		fw_setenv mtdparts "nmbm0:1024k(bl2),256k(Nvram),256k(Bdata),2048k(factory),2048k(fip),256k(crash),256k(crash_log),34816k(ubi),34816k(ubi1),32768k(overlay),12288k(data),256k(KF)"
 		;;
-	xiaomi,redmi-router-ax6000-stock)
-		fw_setenv mtdparts "nmbm0:1024k(bl2),256k(Nvram),256k(Bdata),2048k(factory),2048k(fip),256k(crash),256k(crash_log),30720k(ubi),30720k(ubi1),51200k(overlay)"
-		;;
 	esac
 }
 
@@ -63,135 +187,40 @@ platform_do_upgrade() {
 	local board=$(board_name)
 
 	case "$board" in
-	abt,asr3000|\
-	cmcc,a10|\
-	cudy,tr3000-v1-ubootmod|\
-	h3c,magic-nx30-pro|\
-	imou,lc-hx3001|\
-	jcg,q30|\
-	konka,komi-a31|\
-	mediatek,mt7981-rfb|\
-	netcore,n60|\
-	netcore,n60-pro|\
-	nokia,ea0326gmp|\
-	qihoo,360t7|\
-	tplink,tl-xdr4288|\
-	tplink,tl-xdr6086|\
-	tplink,tl-xdr6088|\
-	tplink,tl-xtr8488|\
-	xiaomi,mi-router-ax3000t-ubootmod|\
-	xiaomi,mi-router-wr30u-ubootmod|\
-	xiaomi,redmi-router-ax6000-ubootmod)
-		CI_KERNPART="fit"
-		nand_do_upgrade "$1"
-		;;
-	acer,predator-w6|\
-	huasifei,wh3000-emmc|\
-	smartrg,sdg-8612|\
-	smartrg,sdg-8614|\
-	smartrg,sdg-8622|\
-	smartrg,sdg-8632)
-		CI_KERNPART="kernel"
-		CI_ROOTPART="rootfs"
-		emmc_do_upgrade "$1"
-		;;
-	asus,rt-ax59u|\
-	asus,tuf-ax4200|\
-	asus,tuf-ax6000)
-		CI_UBIPART="UBI_DEV"
-		CI_KERNPART="linux"
+	xiaomi,mi-router-wr30u-112m|\
+	xiaomi,mi-router-ax3000t|\
+	*mt3000* |\
+	glinet,x3000-emmc |\
+	*xe3000* |\
+	*mt2500* |\
+	*zr-3020* |\
+	*360,t7* |\
+	*abt,asr3000* |\
+	*cetron,ct3003* |\
+	*clt,r30b1* |\
+	*imou,lc-hx3001* |\
+	*jcg,q30* |\
+	nradio,wt9103 |\
+	cmcc,a10 |\
+	cmcc,rax3000m |\
+	h3c,nx30pro |\
+	*konka,komi-a31* |\
+	*snand*)
 		nand_do_upgrade "$1"
 		;;
-	bananapi,bpi-r3|\
-	bananapi,bpi-r3-mini)
-		local rootdev="$(cmdline_get_var root)"
-		rootdev="${rootdev##*/}"
-		rootdev="${rootdev%p[0-9]*}"
-		case "$rootdev" in
-		mmc*)
-			CI_ROOTDEV="$rootdev"
-			CI_KERNPART="production"
-			emmc_do_upgrade "$1"
-			;;
-		mtdblock*)
-			PART_NAME="fit"
-			default_do_upgrade "$1"
-			;;
-		ubiblock*)
-			CI_KERNPART="fit"
-			nand_do_upgrade "$1"
-			;;
-		esac
-		;;
-	cmcc,rax3000m|\
-	cmcc,rax3000me)
-		case "$(cmdline_get_var root)" in
-		/dev/mmc*)
-			CI_KERNPART="production"
-			emmc_do_upgrade "$1"
-			;;
-		*)
-			CI_KERNPART="fit"
-			nand_do_upgrade "$1"
-			;;
-		esac
-		;;
-	cmcc,rax3000m-emmc-ubootmod|\
-	glinet,gl-mt2500|\
-	glinet,gl-mt6000)
+	cmcc,rax3000m-emmc |\
+	HCMT7981-EMMC |
+	*emmc*)
 		CI_KERNPART="kernel"
 		CI_ROOTPART="rootfs"
 		emmc_do_upgrade "$1"
 		;;
-	cudy,re3000-v1|\
-	cudy,wr3000-v1|\
-	yuncore,ax835)
-		default_do_upgrade "$1"
-		;;
-	jdcloud,re-cp-03)
-		CI_KERNPART="production"
-		emmc_do_upgrade "$1"
-		;;
-	mercusys,mr90x-v1)
-		CI_UBIPART="ubi0"
-		nand_do_upgrade "$1"
-		;;
-	ubnt,unifi-6-plus)
-		CI_KERNPART="kernel0"
-		EMMC_ROOT_DEV="$(cmdline_get_var root)"
-		emmc_do_upgrade "$1"
-		;;
-	xiaomi,mi-router-ax3000t|\
-	xiaomi,mi-router-wr30u-stock|\
-	xiaomi,redmi-router-ax6000-stock)
-		CI_KERN_UBIPART=ubi_kernel
-		CI_ROOT_UBIPART=ubi
-		nand_do_upgrade "$1"
-		;;
-	zyxel,ex5601-t0-ubootmod)
-		CI_KERNPART="fit"
-		CI_ROOTPART="ubi_rootfs"
-		nand_do_upgrade "$1"
-                ;;
-	unielec,u7981-01*)
-		local rootdev="$(cmdline_get_var root)"
-		rootdev="${rootdev##*/}"
-		rootdev="${rootdev%p[0-9]*}"
-		case "$rootdev" in
-		mmc*)
-			CI_ROOTDEV="$rootdev"
-			CI_KERNPART="kernel"
-			CI_ROOTPART="rootfs"
-			emmc_do_upgrade "$1"
-			;;
-		*)
-			CI_KERNPART="fit"
-			nand_do_upgrade "$1"
-			;;
-		esac
+	xiaomi,mi-router-ax3000t-stock|\
+	xiaomi,mi-router-wr30u-stock)
+		xiaomi_mt7981_nand_upgrade_tar "$1"
 		;;
 	*)
-		nand_do_upgrade "$1"
+		default_do_upgrade "$1"
 		;;
 	esac
 }
@@ -205,62 +234,57 @@ platform_check_image() {
 	[ "$#" -gt 1 ] && return 1
 
 	case "$board" in
-	bananapi,bpi-r3|\
-	bananapi,bpi-r3-mini|\
-	cmcc,rax3000m|\
-	cmcc,rax3000me)
-		[ "$magic" != "d00dfeed" ] && {
+	*mt3000* |\
+	glinet,x3000-emmc |\
+	*xe3000* |\
+	*mt2500* |\
+	*zr-3020* |\
+	*360,t7* |\
+	xiaomi,mi-router-wr30u-stock|\
+	xiaomi,mi-router-wr30u-112m|\
+	xiaomi,mi-router-ax3000t* |\
+	*abt,asr3000* |\
+	*cetron,ct3003* |\
+	*clt,r30b1* |\
+	*imou,lc-hx3001* |\
+	*jcg,q30* |\
+	cmcc,a10 |\
+	cmcc,rax3000m* |\
+	HCMT7981-EMMC |
+	h3c,nx30pro |\
+	*konka,komi-a31* |\
+	nradio,wt9103 |\
+	*snand* |\
+	*emmc*)
+		# tar magic `ustar`
+		magic="$(dd if="$1" bs=1 skip=257 count=5 2>/dev/null)"
+
+		[ "$magic" != "ustar" ] && {
 			echo "Invalid image type."
 			return 1
 		}
+
 		return 0
 		;;
 	*)
-		nand_do_platform_check "$board" "$1"
-		return $?
+		[ "$magic" != "d00dfeed" ] && {
+			echo "Invalid image type."
+			return 1
+		}
+		return 0
 		;;
 	esac
 
 	return 0
 }
 
-platform_copy_config() {
-	case "$(board_name)" in
-	acer,predator-w6|\
-	cmcc,rax3000m-emmc-ubootmod|\
-	glinet,gl-mt2500|\
-	glinet,gl-mt6000|\
-	huasifei,wh3000-emmc|\
-	jdcloud,re-cp-03|\
-	ubnt,unifi-6-plus)
-		emmc_copy_config
-		;;
-	bananapi,bpi-r3|\
-	bananapi,bpi-r3-mini|\
-	cmcc,rax3000m|\
-	cmcc,rax3000me)
-		case "$(cmdline_get_var root)" in
-		/dev/mmc*)
-			emmc_copy_config
-			;;
-		esac
-		;;
-	esac
-}
-
 platform_pre_upgrade() {
 	local board=$(board_name)
 
 	case "$board" in
-	asus,rt-ax59u|\
-	asus,tuf-ax4200|\
-	asus,tuf-ax6000)
-		asus_initial_setup
-		;;
-	xiaomi,mi-router-ax3000t|\
-	xiaomi,mi-router-wr30u-stock|\
-	xiaomi,redmi-router-ax6000-stock)
-		xiaomi_initial_setup
+	xiaomi,mi-router-ax3000t-stock|\
+	xiaomi,mi-router-wr30u-stock)
+		xiaomi_mt7981_initial_setup
 		;;
 	esac
 }
diff --git a/target/linux/mediatek/image/filogic.mk b/target/linux/mediatek/image/filogic.mk
index e57cffb..0ea68da 100644
--- a/target/linux/mediatek/image/filogic.mk
+++ b/target/linux/mediatek/image/filogic.mk
@@ -1816,3 +1816,23 @@ define Device/zyxel_nwa50ax-pro
   IMAGE/sysupgrade.bin := sysupgrade-tar | append-metadata
 endef
 TARGET_DEVICES += zyxel_nwa50ax-pro
+
+define Device/nradio_c8-668-2nd
+  DEVICE_VENDOR := Nradio
+  DEVICE_MODEL := C8-668
+  DEVICE_VARIANT := 2nd System (eMMC)
+  DEVICE_DTS := mt7981b-nradio-c8-668-2nd
+  DEVICE_DTS_DIR := ../dts
+  SUPPORTED_DEVICES := HCMT7981-EMMC
+  DEVICE_PACKAGES := kmod-usb3 kmod-mt7981-firmware mt7981-wo-firmware \
+	automount f2fsck mkf2fs \
+	kmod-usb-net-qmi-wwan uqmi kmod-usb-serial-option \
+	kmod-usb-net-cdc-ether kmod-usb-net-rndis kmod-usb-net-cdc-mbim \
+	uboot-envtools
+  KERNEL := kernel-bin | lzma | fit lzma $$(KDIR)/image-$$(firstword $$(DEVICE_DTS)).dtb
+  KERNEL_INITRAMFS := kernel-bin | lzma | \
+	fit lzma $$(KDIR)/image-$$(firstword $$(DEVICE_DTS)).dtb with-initrd | pad-to 64k
+  IMAGE/sysupgrade.bin := sysupgrade-tar | append-metadata
+endef
+TARGET_DEVICES += nradio_c8-668-2nd
+
diff --git a/feeds.conf.default b/feeds.conf.default
index 995e4d1..db051c2 100644
--- a/feeds.conf.default
+++ b/feeds.conf.default
@@ -1,4 +1,4 @@
-src-git packages https://github.com/immortalwrt/packages.git;openwrt-23.05
-src-git luci https://github.com/immortalwrt/luci.git;openwrt-23.05
-src-git routing https://github.com/openwrt/routing.git;openwrt-23.05
-src-git telephony https://github.com/openwrt/telephony.git;openwrt-23.05
+src-git packages https://github.com/immortalwrt/packages.git^ec83425afb8db6f6de1eb53b968a104ff3d06e7f
+src-git luci https://github.com/immortalwrt/luci.git^bdf571c0ea5b9b029707787e0f89be7bbd3d75e3
+src-git routing https://github.com/openwrt/routing.git^a4a02e700e7840ba0d01cc5677a36257864291c8
+src-git istore https://github.com/linkease/istore.git^a4a02e700e7840ba0d01cc5677a36257864291c8
